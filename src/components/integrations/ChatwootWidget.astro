---
/**
 * ChatwootWidget.astro
 *
 * Chatwoot Live Chat Widget
 *
 * Purpose:
 * - Self-hosted live chat support widget
 * - Customer service and support
 *
 * Environment Variables Required:
 * - PUBLIC_CHATWOOT_URL: Chatwoot base URL (e.g., https://chatwoot.jobnagringa.com.br)
 * - PUBLIC_CHATWOOT_TOKEN: Website token for authentication
 *
 * Migration Notes:
 * - Currently DISABLED in production (commented out in source)
 * - Widget position: right side
 * - Type: expanded_bubble with "Duvidas?" label
 * - Self-hosted at chatwoot.jobnagringa.com.br
 * - To enable: set enabled prop to true
 */

interface Props {
  /**
   * Enable the Chatwoot widget
   * @default false (currently disabled in production)
   */
  enabled?: boolean;

  /**
   * Widget position on screen
   * @default 'right'
   */
  position?: 'left' | 'right';

  /**
   * Widget type
   * @default 'expanded_bubble'
   */
  type?: 'standard' | 'expanded_bubble';

  /**
   * Launcher button title
   * @default 'Duvidas?'
   */
  launcherTitle?: string;
}

const {
  enabled = false,
  position = 'right',
  type = 'expanded_bubble',
  launcherTitle = 'Duvidas?'
} = Astro.props;

const chatwootUrl = import.meta.env.PUBLIC_CHATWOOT_URL || 'https://chatwoot.jobnagringa.com.br';
const chatwootToken = import.meta.env.PUBLIC_CHATWOOT_TOKEN;

// Only render if enabled and token is available
const shouldRender = enabled && chatwootToken;
---

{shouldRender && (
  <script is:inline define:vars={{ chatwootUrl, chatwootToken, position, type, launcherTitle }}>
    window.chatwootSettings = {
      position: position,
      type: type,
      launcherTitle: launcherTitle
    };

    (function(d, t) {
      const g = d.createElement(t),
    s = d.getElementsByTagName(t)[0];
      g.src = chatwootUrl + "/packs/js/sdk.js";
      g.defer = true;
      g.async = true;
      s.parentNode.insertBefore(g, s);
      g.onload = function() {
        window.chatwootSDK.run({
          websiteToken: chatwootToken,
          baseUrl: chatwootUrl
        });
      };
    })(document, "script");
  </script>
)}
