---
/**
 * Head Component - Common meta tags, scripts, and styles for all pages
 *
 * @prop {string} title - Page title
 * @prop {string} description - Meta description
 * @prop {string} ogTitle - Open Graph title (defaults to title)
 * @prop {string} ogDescription - Open Graph description (defaults to description)
 * @prop {string} ogImage - Open Graph image URL
 * @prop {boolean} noIndex - Whether to add noindex meta tag
 * @prop {string} lang - HTML lang attribute (defaults to pt-BR)
 */

interface Props {
  title: string;
  description?: string;
  ogTitle?: string;
  ogDescription?: string;
  ogImage?: string;
  noIndex?: boolean;
  lang?: string;
}

const {
  title,
  description = '',
  ogTitle,
  ogDescription,
  ogImage = 'https://cdn.prod.website-files.com/642953c962519376c853ab81/66fa20663b706c601554155b_og-image-jng.jpg',
  noIndex = false,
  lang = 'pt-BR',
} = Astro.props;

const finalOgTitle = ogTitle || title;
const finalOgDescription = ogDescription || description;

// Content Security Policy - allows necessary third-party resources
const cspContent = [
  "default-src 'self'",
  "script-src 'self' 'unsafe-inline' 'unsafe-eval' https://clerk.jobnagringa.com.br https://www.googletagmanager.com https://d3e54v103j8qbb.cloudfront.net https://cdn.jsdelivr.net https://mautic.jobnagringa.com.br https://analytics.ahrefs.com",
  "style-src 'self' 'unsafe-inline' https://fonts.googleapis.com",
  "font-src 'self' https://fonts.gstatic.com",
  "img-src 'self' data: blob: https: http:",
  "connect-src 'self' https://clerk.jobnagringa.com.br https://www.googletagmanager.com https://mautic.jobnagringa.com.br https://analytics.ahrefs.com https://*.google-analytics.com",
  "frame-src 'self' https://www.googletagmanager.com https://accounts.jobnagringa.com.br",
  "object-src 'none'",
  "base-uri 'self'",
  "form-action 'self' https://clerk.jobnagringa.com.br https://accounts.jobnagringa.com.br",
  "frame-ancestors 'self'",
  "upgrade-insecure-requests"
].join('; ');
// Import critical CSS for inlining
import criticalCSS from '../styles/critical/base.css?raw';
---

<!-- Document charset - must be first -->
<meta charset="utf-8" />

<!-- Security Headers via meta tags -->
<meta http-equiv="Content-Security-Policy" content={cspContent} />
<meta http-equiv="X-Content-Type-Options" content="nosniff" />
<meta http-equiv="X-Frame-Options" content="SAMEORIGIN" />
<meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin" />
<meta http-equiv="Permissions-Policy" content="camera=(), microphone=(), geolocation=()" />
<title>{title}</title>
{description && <meta content={description} name="description" />}
<meta content={finalOgTitle} property="og:title" />
{finalOgDescription && <meta content={finalOgDescription} property="og:description" />}
<meta content={ogImage} property="og:image" />
<meta content={finalOgTitle} property="twitter:title" />
{finalOgDescription && <meta content={finalOgDescription} property="twitter:description" />}
<meta content={ogImage} property="twitter:image" />
<meta property="og:type" content="website" />
<meta content="summary_large_image" name="twitter:card" />
<meta content="width=device-width, initial-scale=1" name="viewport" />

<!-- Preconnect to critical third-party origins (improves LCP) -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link rel="preconnect" href="https://www.googletagmanager.com" />
<link rel="preconnect" href="https://clerk.jobnagringa.com.br" crossorigin />

<!-- DNS prefetch for non-critical origins -->
<link rel="dns-prefetch" href="https://d3e54v103j8qbb.cloudfront.net" />
<link rel="dns-prefetch" href="https://cdn.jsdelivr.net" />
<link rel="dns-prefetch" href="https://analytics.ahrefs.com" />
<link rel="dns-prefetch" href="https://mautic.jobnagringa.com.br" />

<!-- Preload critical fonts (highest priority for LCP) -->
<link
  rel="preload"
  href="/fonts/inter-var-latin.woff2"
  as="font"
  type="font/woff2"
  crossorigin
/>

<!--
  Font Loading Strategy:
  - Self-hosted Inter variable font (better caching, fewer requests)
  - font-display: swap for immediate text rendering (no FOIT)
  - Variable font reduces file count (1 file vs 9 weight files)
  - Anton and Exo 2 loaded async (non-critical, for headings only)
-->
<style is:inline>
  /* Self-hosted Inter Variable Font - Critical for body text */
  @font-face {
    font-family: 'Inter';
    font-style: normal;
    font-weight: 100 900;
    font-display: swap;
    src: url('/fonts/inter-var-latin.woff2') format('woff2');
    unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC,
      U+0304, U+0308, U+0329, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212,
      U+2215, U+FEFF, U+FFFD;
  }

  /* Extended Latin support (Portuguese characters) */
  @font-face {
    font-family: 'Inter';
    font-style: normal;
    font-weight: 100 900;
    font-display: swap;
    src: url('/fonts/inter-var-latin-ext.woff2') format('woff2');
    unicode-range: U+0100-02AF, U+0304, U+0308, U+0329, U+1E00-1E9F, U+1EF2-1EFF, U+2020,
      U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
  }
</style>

<!-- Anton and Exo 2 fonts - Non-critical, async load for headings -->
<link
  rel="preload"
  href="https://fonts.googleapis.com/css2?family=Anton&family=Exo+2:wght@400;500;600;700&display=swap"
  as="style"
  onload="this.onload=null;this.rel='stylesheet'"
/>
<noscript>
  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Anton&family=Exo+2:wght@400;500;600;700&display=swap"
  />
</noscript>

<!-- Favicon (early in head for faster display) -->
<link href="/images/favicon.jpg" rel="shortcut icon" type="image/x-icon" />
<link href="/images/webclip.jpg" rel="apple-touch-icon" />

<!--
  CSS Loading Strategy for Performance:
  1. Critical CSS is inlined above (fonts, layout basics)
  2. Main CSS is loaded via Astro's CSS import system in index.css
     which gets processed by PostCSS (PurgeCSS + cssnano in production)
  3. CSS code splitting ensures each page only loads what it needs
-->

<!-- Webflow touch detection (critical - runs synchronously but is tiny) -->
<script is:inline>
  !(function (o, c) {
    const n = c.documentElement,
    t = ' w-mod-';
    n.className += t + 'js';
    // Modern touch detection - DocumentTouch is deprecated
    // Use standard feature detection methods instead
    if ('ontouchstart' in o || o.navigator.maxTouchPoints > 0) {
      n.className += t + 'touch';
    }
  })(window, document);
</script>

<!--
  Critical CSS - Inlined for instant above-the-fold rendering
  Contains: CSS variables, base reset, navigation, hero, buttons, containers
  This prevents layout shift (CLS) and improves LCP
-->
<style is:inline set:html={criticalCSS}></style>

<!-- Custom error/validation styles and accessibility utilities -->
<style>
  .hide {
    display: none;
  }
  .error {
    border: 1px red solid;
  }
  .success {
    border: 1px #0acf0a solid;
  }
  .error-message {
    font-size: 12px;
    color: red;
    margin-top: -8px;
  }
  /* Visually hidden class for screen reader only content (WCAG compliant) */
  .visually-hidden,
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }
  /* Allow visually hidden content to be focusable */
  .visually-hidden:focus,
  .sr-only:focus {
    position: static;
    width: auto;
    height: auto;
    padding: inherit;
    margin: inherit;
    overflow: visible;
    clip: auto;
    white-space: normal;
  }
</style>

{noIndex && <meta name="robots" content="noindex" />}

<slot />
