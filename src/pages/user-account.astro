---
/**
 * User Account Page
 *
 * User account management page.
 * Uses DashboardLayout for authenticated users.
 */

import DashboardLayout from '../layouts/DashboardLayout.astro';
---

<DashboardLayout
  title="Minha Conta - #jobnagringa"
  description="Gerencie sua conta do #jobnagringa"
  noIndex={true}
>
  <div class="account_section">
    <div class="account_header">
      <h1 class="heading-style-h2">Minha Conta</h1>
      <p class="text-color-muted">Gerencie suas informacoes pessoais e preferencias.</p>
    </div>

    <div class="spacer-large"></div>

    <div class="account_content">
      <div class="account_card">
        <h2 class="heading-style-h4">Informacoes Pessoais</h2>
        <div class="spacer-small"></div>
        <div class="account_info-grid">
          <div class="account_info-item">
            <label class="text-size-small text-color-muted">Nome</label>
            <p class="text-weight-medium" data-ms-member="first-name">Carregando...</p>
          </div>
          <div class="account_info-item">
            <label class="text-size-small text-color-muted">Email</label>
            <p class="text-weight-medium" data-ms-member="email">Carregando...</p>
          </div>
        </div>
        <div class="spacer-medium"></div>
        <a
          href="https://accounts.jobnagringa.com.br/user"
          class="button is-secondary w-button"
          target="_blank"
        >
          Editar Perfil
        </a>
      </div>

      <div class="account_card">
        <h2 class="heading-style-h4">Assinatura</h2>
        <div class="spacer-small"></div>
        <div class="account_subscription" data-ms-content="community">
          <div class="account_badge is-active">Ativo</div>
          <p>Voce e membro do #JNG Community</p>
        </div>
        <div class="account_subscription" data-ms-content="!community">
          <div class="account_badge is-inactive">Inativo</div>
          <p>Voce ainda nao e assinante</p>
          <div class="spacer-small"></div>
          <a href="/assine" class="button w-button">Assinar Agora</a>
        </div>
      </div>

      <div class="account_card">
        <h2 class="heading-style-h4">Seguranca</h2>
        <div class="spacer-small"></div>
        <a
          href="https://accounts.jobnagringa.com.br/user"
          class="button is-secondary w-button"
          target="_blank"
        >
          Alterar Senha
        </a>
      </div>
    </div>
  </div>
</DashboardLayout>

<script is:inline>
  // Update localStorage with user data from Webflow account fields
  document.addEventListener('DOMContentLoaded', function () {
    try {
      var elements = document.querySelectorAll('[data-ms-member]');
      var userData = {};

      elements.forEach(function (el) {
        var field = el.getAttribute('data-ms-member');
        var value = el.textContent || el.value;
        if (field && value) {
          userData[field] = value;
        }
      });

      if (Object.keys(userData).length > 0) {
        var existing = {};
        try {
          existing = JSON.parse(localStorage.getItem('user') || '{}');
        } catch (e) {}

        var merged = Object.assign({}, existing, userData);
        localStorage.setItem('user', JSON.stringify(merged));
      }
    } catch (e) {
      console.error('Error updating user data:', e);
    }
  });
</script>

<style>
  .account_section {
    padding: 2rem;
  }

  .account_header {
    margin-bottom: 2rem;
  }

  .account_content {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    max-width: 800px;
  }

  .account_card {
    background: white;
    padding: 1.5rem;
    border-radius: 0.5rem;
    border: 1px solid var(--neutrals--neutral-200, #e5e5e5);
  }

  .account_info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
  }

  .account_info-item {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
  }

  .account_badge {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 1rem;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    margin-bottom: 0.5rem;
  }

  .account_badge.is-active {
    background: var(--semantic--success-light, #d4edda);
    color: var(--semantic--success, #28a745);
  }

  .account_badge.is-inactive {
    background: var(--neutrals--neutral-200, #e5e5e5);
    color: var(--neutrals--neutral-600, #666);
  }
</style>
