---
/**
 * LandingLayout Component - Layout for marketing/landing pages
 *
 * This layout is used for public-facing marketing pages like:
 * - Home page
 * - Subscription page (assine)
 * - Sign up pages
 * - Blog pages
 *
 * Features:
 * - Public navigation variant
 * - Clerk authentication scripts for login state detection
 * - Content visibility control based on membership
 * - Optional MAV (Marketing Attribution) tracking
 *
 * @prop {string} title - Page title
 * @prop {string} description - Meta description
 * @prop {string} ogTitle - Open Graph title
 * @prop {string} ogDescription - Open Graph description
 * @prop {string} ogImage - Open Graph image URL
 * @prop {string} currentPage - Current page for nav active state
 * @prop {boolean} showWhatsappSupport - Show WhatsApp support button
 * @prop {boolean} enableMavTracking - Enable MAV marketing tracking
 * @prop {string} mavAccountId - MAV account ID
 * @prop {string} mavPageId - MAV page ID
 */

import Head from '../components/Head.astro';
import Navigation from '../components/Navigation.astro';
import Footer from '../components/Footer.astro';

interface Props {
  title: string;
  description?: string;
  ogTitle?: string;
  ogDescription?: string;
  ogImage?: string;
  currentPage?: string;
  showWhatsappSupport?: boolean;
  enableMavTracking?: boolean;
  mavAccountId?: string;
  mavPageId?: string;
}

const {
  title,
  description = '',
  ogTitle,
  ogDescription,
  ogImage,
  currentPage = '',
  showWhatsappSupport = false,
  enableMavTracking = false,
  mavAccountId = '',
  mavPageId = '',
} = Astro.props;
---

<!DOCTYPE html>
<html data-wf-site="642953c962519376c853ab81" lang="pt-BR">
<head>
  <Head
    title={title}
    description={description}
    ogTitle={ogTitle}
    ogDescription={ogDescription}
    ogImage={ogImage}
    noIndex={false}
    lang="pt-BR"
  >
    <!-- Clerk Authentication (async - critical for auth state detection) -->
    <script async crossorigin="anonymous" data-clerk-publishable-key="pk_live_Y2xlcmsuam9ibmFncmluZ2EuY29tLmJyJA" src="https://clerk.jobnagringa.com.br/npm/@clerk/clerk-js@5/dist/clerk.browser.js"></script>
    <script is:inline>
      const COOKIE_NAME="user",LOCAL_KEY="user",COOKIE_TTL=86400;
      function setCookie(e,n,t,o){const r=[encodeURIComponent(e)+"="+encodeURIComponent(n),"path=/","max-age="+t];o&&o.domain&&r.push("domain="+o.domain),o&&o.secure&&r.push("secure"),o&&o.sameSite&&r.push("samesite="+o.sameSite),document.cookie=r.join("; ")}
      function persistUserData(e){window.user=e;try{localStorage.setItem(LOCAL_KEY,JSON.stringify(e))}catch(e){}try{let n=null,t=null;e&&e.primaryEmailAddress&&e.primaryEmailAddress.emailAddress?n=e.primaryEmailAddress.emailAddress:e&&e.emailAddresses&&e.emailAddresses.length&&(n=e.emailAddresses[0]&&e.emailAddresses[0].emailAddress||null),e&&e.primaryPhoneNumber&&e.primaryPhoneNumber.phoneNumber?t=e.primaryPhoneNumber.phoneNumber:e&&e.phoneNumbers&&e.phoneNumbers.length&&(t=e.phoneNumbers[0]&&e.phoneNumbers[0].phoneNumber||null);const o={firstName:e&&e.firstName||null,phoneNumber:t,email:n,publicMetadata:e&&e.publicMetadata||{}},r="https:"===window.location.protocol,a=window.location.hostname,i=a.slice(-".jobnagringa.com.br".length)===".jobnagringa.com.br"?".jobnagringa.com.br":void 0;setCookie(COOKIE_NAME,JSON.stringify(o),COOKIE_TTL,{secure:r,sameSite:"Strict",domain:i})}catch(e){}}
      function getUserFromCookie(){try{for(var e=document.cookie?document.cookie.split(";"):[],n=null,t=0;t<e.length;t++){const o=e[t].replace(/^\s+|\s+$/g,"");if(0===o.indexOf(COOKIE_NAME+"=")){n=o;break}}if(!n)return null;let r="";try{r=decodeURIComponent(n.split("=")[1]||"")}catch(e){r=""}if(!r)return null;let a=null;try{a=window.JSON&&JSON.parse?JSON.parse(r):null}catch(e){a=null}return a}catch(e){return null}}
      function userIsPaidCustomer(){try{const e=getUserFromCookie();return!!(e&&e.publicMetadata&&e.publicMetadata.isPaidCustomer===!0)}catch(e){return!1}}
      function populateFirstNameFromUser(){try{const e=getUserFromCookie();if(!e)return;let n="";e.firstName&&""!==String(e.firstName).replace(/^\s+|\s+$/g,"")?n=String(e.firstName).replace(/^\s+|\s+$/g,""):e.fullName&&""!==String(e.fullName).replace(/^\s+|\s+$/g,"")?n=String(e.fullName).replace(/^\s+|\s+$/g,"").split(/\s+/)[0]:e.username&&""!==String(e.username).replace(/^\s+|\s+$/g,"")&&(n=String(e.username).replace(/^\s+|\s+$/g,""));if(!n)return;for(let t=document.querySelectorAll?document.querySelectorAll('[data-ms-member="first-name"]'):[],o=0;o<t.length;o++)"value"in t[o]?t[o].value=n:t[o].textContent=n}catch(e){}}
      function handleCommunityContent(){try{for(let e=userIsPaidCustomer()?'[data-ms-content="!community"]':'[data-ms-content="community"]',n=document.querySelectorAll?document.querySelectorAll(e):[],t=0;t<n.length;t++){const o=n[t];o&&o.parentNode&&o.parentNode.removeChild(o)}}catch(e){}}
      !function(){function e(){if(!window.Clerk||!Clerk.load)return;let e=null;try{e=Clerk.load()}catch(e){}e&&e.then?e.then(function(){try{const e=Clerk.user;e&&persistUserData(e)}catch(e){}}).catch(function(){}):setTimeout(function(){try{const e=Clerk.user;e&&persistUserData(e)}catch(e){}},1e3)}window.addEventListener?window.addEventListener("load",e):window.attachEvent?window.attachEvent("onload",e):function(e){const n=window.onload;window.onload=function(t){n&&n.call(e,t),e()}}(e)}();
      function runDomFuncs(){populateFirstNameFromUser(),handleCommunityContent()}
      document.addEventListener?(document.addEventListener("DOMContentLoaded",runDomFuncs),window.addEventListener&&window.addEventListener("load",runDomFuncs)):document.attachEvent?(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&runDomFuncs()}),window.attachEvent&&window.attachEvent("onload",runDomFuncs)):function(e){const n=window.onload;window.onload=function(t){n&&n.call(e,t),runDomFuncs()}}(window);
    </script>

    <!-- Content visibility based on membership -->
    <script is:inline>
      !function(){function e(){try{for(var e="user",t=document.cookie?document.cookie.split(";"):[],n=null,o=0;o<t.length;o++){const r=t[o].replace(/^\s+|\s+$/g,"");if(0===r.indexOf(e+"=")){n=r;break}}if(!n)return null;let a="";try{a=decodeURIComponent((n.split("=")[1]||""))}catch(e){a=""}if(!a)return null;let c=null;try{c=window.JSON&&JSON.parse?JSON.parse(a):null}catch(e){c=null}return c}catch(e){return null}}function t(){const t=e();return!!(t&&t.publicMetadata&&t.publicMetadata.isPaidCustomer===!0)}function n(e,t){try{for(var n,o=document.getElementsByTagName("*"),r=o.length-1;r>=0;r--)n=o[r],n&&n.getAttribute&&n.getAttribute(e)===t&&n.parentNode&&n.parentNode.removeChild(n)}catch(e){}}function o(){t()?n("data-ms-content","!community"):n("data-ms-content","community")}o(),document.addEventListener?(document.addEventListener("DOMContentLoaded",o),window.addEventListener&&window.addEventListener("load",o)):document.attachEvent?(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&o()}),window.attachEvent&&window.attachEvent("onload",o)):(function(e){const t=window.onload;window.onload=function(n){t&&t.call(e,n),o()}})(window)}();
    </script>

    <slot name="head" />
  </Head>

  {enableMavTracking && (
    <script is:inline define:vars={{ mavAccountId, mavPageId }}>
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});const f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-M7FNJJJ2');
      // Create hidden inputs in body
      document.addEventListener('DOMContentLoaded', function() {
        const accountInput = document.getElementById('accountID');
        const accountPageInput = document.getElementById('accountPageID');
        if (!accountInput) {
          const input1 = document.createElement('input');
          input1.type = 'hidden';
          input1.id = 'accountID';
          input1.value = mavAccountId;
          document.body.appendChild(input1);
        }
        if (!accountPageInput) {
          const input2 = document.createElement('input');
          input2.type = 'hidden';
          input2.id = 'accountPageID';
          input2.value = mavPageId;
          document.body.appendChild(input2);
        }
      });
    </script>
  )}
</head>
<body>
  <!-- Skip to main content link for accessibility -->
  <a href="#main-content" class="skip-to-content">
    Skip to main content
  </a>

  <!-- Google Tag Manager (noscript) -->
  <noscript>
    <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-58XVRQZ" height="0" width="0" style="display:none;visibility:hidden" title="Google Tag Manager"></iframe>
  </noscript>

  <div class="page_wrapper">
    <!-- Global styles -->
    <div class="general_style w-embed">
      <style>
        /* Skip to content link - visible only on focus for keyboard users */
        .skip-to-content {
          position: absolute;
          top: -100%;
          left: 50%;
          transform: translateX(-50%);
          background: #0071ff;
          color: #fff;
          padding: 0.75rem 1.5rem;
          border-radius: 0 0 0.5rem 0.5rem;
          text-decoration: none;
          font-weight: 600;
          z-index: 10000;
          transition: top 0.2s ease;
        }
        .skip-to-content:focus {
          top: 0;
          outline: 0.125rem solid #fff;
          outline-offset: 0.125rem;
        }
        /* Focus state style for keyboard navigation */
        *[tabindex]:focus-visible,
        input[type="file"]:focus-visible {
          outline: 0.125rem solid #4d65ff;
          outline-offset: 0.125rem;
        }
        /* Enhanced focus styles for interactive elements */
        a:focus-visible,
        button:focus-visible,
        input:focus-visible,
        select:focus-visible,
        textarea:focus-visible {
          outline: 0.125rem solid #4d65ff;
          outline-offset: 0.125rem;
        }
        /* width */
        ::-webkit-scrollbar {
          width: 0.5rem;
          height: 0.5rem;
        }
        /* Track */
        ::-webkit-scrollbar-track {
          border-radius: 100rem;
          background: #fff;
        }
        /* Handle */
        ::-webkit-scrollbar-thumb {
          border-radius: 100rem;
          background: var(--neutrals--neutral-300);
        }
        /* Handle on hover */
        ::-webkit-scrollbar-thumb:hover {
          background: var(--blues--blue-20);
        }
        .link-return:hover .button {
          background: var(--blues--blue-50);
          color: #fff;
        }
        /* Updates default Webflow Select */
        select, .input_field.is-select {
          -moz-appearance: none;
          -webkit-appearance: none;
          appearance: none;
          background-position: 100% 50%;
          background-size: 1rem 1rem;
          background-repeat: no-repeat;
          background-position: right 0.5rem center;
        }
        /* Style name acronym */
        [acronym] {
          font-family: monospace;
          width: 2ch;
          overflow: hidden;
          white-space: nowrap;
        }
      </style>
    </div>

    <Navigation isMemberNav={false} currentPage={currentPage} />

    <main id="main-content" tabindex="-1">
      <slot />
    </main>

    <Footer showWhatsappSupport={showWhatsappSupport}>
      <slot name="footer-job-categories" slot="job-categories" />
    </Footer>
  </div>

  <!--
    jQuery + Webflow (defer - needed for interactions but not critical render)
    Using defer ensures they execute in order after HTML parsing
  -->
  <script
    defer
    src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=642953c962519376c853ab81"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    crossorigin="anonymous"
  ></script>
  <script defer src="/js/webflow.js"></script>

  <slot name="scripts" />
</body>
</html>
